**设计规范：**

1. 加速器必须能够计算固定大小的输入矩阵（32x32）与大小为5x5的小正方形内核的卷积。
2. 输入矩阵和内核中的元素类型为定点（例如，8.8)。
3. 输出矩阵的大小必须与输入矩阵相同（需要零填充）。
4. 加速器的矩阵输入需要保留（不能被覆盖）。
5. 矩阵值将保留在主存储器中。
6. CPU需要配置加速器，以执行所请求的矩阵卷积。
7. 加速器可能有其自己的内存管理（例如，寄存器或缓冲区），用于加载和存储数据操作数和输出。理想情况下，内存传输应独立于CPU（提示：DMA)。
8. 加速器可能有其自身的内部存储器，但总的内部存储器应受到限制。
9. 您应该为CPU设计新的R格式指令，以配置和与加速器交互，并支持加速器的功能。
10. 加速器应该向CPU指示其计算已经完成。发生这种情况的机制是您的设计决定。
11. 加速器应让处理器知道计算是否正确完成，结果是否可以依赖，或者是否发生了一些错误。
12. 提供测试代码（使用RoCC宏将您的函数包含在自定义指令中），以显示相对于使用基本处理器，加速器实现的性能加速。

**核心思路：**

- **简化数据通路：** 避免复杂的 `im2col` 硬件转换。我们将假设数据以适合直接卷积的方式被 DMA 加载和处理。
- **简化控制：** 由于尺寸固定 (输入 32x32, 卷积核最大 5x5)，很多控制信号和循环边界可以简化。
- **DMA 核心：** DMA 负责将输入特征图 (IFM)、卷积核 (Kernel/Weights) 从主存加载到加速器内部的专用缓冲区，并将输出特征图 (OFM) 从加速器缓冲区写回主存。
- **配置与执行分离：** 使用不同的 RoCC 指令来配置地址、参数，并启动运算。

### RoCC 指令设计 (针对简单卷积)

为了保持简单，我们可以设计几条核心的 RoCC 指令。这里假设使用 R-Format 指令，其中 `funct` 字段用于区分不同的加速器操作。`rs1` 和 `rs2` 用于传递参数，`rd` 用于接收操作的状态或结果（如果需要）。

1. **`CONFIG_IFM_ADDR` (配置输入特征图地址)**
   - `funct = 0`
   - `rs1`: 输入特征图在主存中的基地址。
   - `rs2`: (可选) 加速器内部 IFM 缓冲区的目标地址/偏移量 (如果需要CPU指定)。如果只有一个固定缓冲区，此参数可能不需要。
   - `rd`: (可选) 返回状态码 (例如，配置成功)。
2. **`CONFIG_KERNEL_ADDR_SIZE` (配置卷积核地址和尺寸)**
   - `funct = 1`
   - `rs1`: 卷积核在主存中的基地址。
   - `rs2`:
     - 低位 (例如 `rs2[4:0]`): 卷积核尺寸 K (例如，3 表示 3x3，5 表示 5x5)。
     - 高位: (可选) 加速器内部卷积核缓冲区的目标地址/偏移量。
   - `rd`: (可选) 返回状态码。
3. **`CONFIG_OFM_ADDR_PARAMS` (配置输出特征图地址和卷积参数)**
   - `funct = 2`
   - `rs1`: 输出特征图在主存中的基地址。
   - `rs2`
     - 低位 (例如 `rs2[7:0]`): 卷积步长 (stride)。由于输出与输入同尺寸 (32x32)，且卷积核最大 5x5，为保持尺寸不变，如果 K=3, stride=1, padding=1; 如果 K=5, stride=1, padding=2。Padding 可以由 K 和 stride 推断，或者在此处明确指定。为了简单，我们假设 stride=1，padding 根据 K 自动推断以保持输出尺寸。
     - (可选) 其他参数，如激活函数类型等，如果您的设计支持。
   - `rd`: (可选) 返回状态码。
4. **`START_CONVOLUTION` (启动卷积运算)**
   - `funct = 3`
   - `rs1`, `rs2`: (可选) 可以不使用，或者用于传递一些运行时的小参数。
   - `rd`: (可选) 可以不立即返回值，CPU 通过后续的 `GET_STATUS` 指令查询。或者，如果 RoCC 支持阻塞，CPU 会等待直到操作完成。对于非阻塞设计，`rd` 可以先返回一个任务 ID 或“已启动”状态。
5. **`GET_STATUS` (获取加速器状态/结果)**
   - `funct = 4`
   - `rs1`: (可选) 任务 ID (如果 `START_CONVOLUTION` 返回任务 ID)。
   - `rs2`: (未使用)
   - `rd`: 返回状态码。例如：
     - `0`: 计算完成且成功。
     - `1`: 仍在计算中。
     - `>1`: 错误代码。

**指令字段分配示例 (基于标准 R-Format `funct7 | rs2 | rs1 | funct3 | rd | opcode`):**

- `opcode`: RoCC 操作码。
- `funct3`: 可以固定，或者用于进一步区分操作的子类型（如果需要）。
- `funct7`: 在这里我们用 `funct` (通常在 RoCC 指令中由 `inst.funct` 字段提供) 来主要区分我们的 5 条指令。
